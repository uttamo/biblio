{% extends '_base.html' %}
{% load static %}
{% load crispy_forms_tags %}

{% block title %}{{ book.title }}{% endblock title %}
{% block content %}
    <a href="{% url 'books' %}"><button type="button" class="btn btn-primary btn-sm mb-2">All Books</button></a>
    <!-- Title -->
    <h2>{{ book.title }}</h2>
    <!-- Author -->
    {% if book.authors.all|length == 1 %}
        <h5 class="text-muted"><a href="{% url 'author_detail' book.authors.all.0.pk %}">{{ book.authors.all.0.full_name }}</a></h5>
    {% else %}
        <h5 class="text-muted">
            {% for author in book.authors.all %}
                {% if forloop.last %}
                    <a href="{% url 'author_detail' author.pk %}">{{ author.full_name }}</a>
                {% else %}
                    <a href="{% url 'author_detail' author.pk %}">{{ author.full_name }},</a>
                {% endif %}
            {% endfor %}
        </h5>
    {% endif %}
    <!-- Cover -->
    {% if book.cover %}
        <img class="bookcover" src="{{ book.cover.url }}" alt="{{ book.title }} cover" style="max-height: 300px">
    {% else %}
        <img class="bookcover" src="{% static "books/placeholder_cover.png" %}" alt="Placeholder cover" style="max-height: 300px">
    {% endif %}
    <p class="mt-3"><strong>Published</strong><br>{{ book.date_published }}</p>
    <p class="mt-3"><strong>Average user rating</strong><br>
        {% with book_rating_info=book.get_rating_info %}
            {% if book_rating_info.no_of_reviews == 0 %}
                No reviews
            {% else %}
                {{ book_rating_info.star_rating_text }} ({{ book_rating_info.no_of_reviews }} review{% if book_rating_info.no_of_reviews > 1 %}s{% endif %})
            {% endif %}
        {% endwith %}
    </p>
    <p class="mt-3"><strong>Description</strong><br>{% if book.description %}{{ book.description }}{% else %}No description.{% endif %}</p>
    <form method="post">
        {% csrf_token %}
        {{ form|crispy }}
        <button class="btn btn-success" type="submit">Submit</button>
    </form>

{% endblock content %}